name: Pre Release
on:
  pull_request:
    paths: [CHANGELOG.md]
    branches: [main]
jobs:
  Post-Comment:
    name: Post Comment
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          source .github/scripts/changelog.sh
          git fetch origin --tags
          if [[ -z "$(git tag -l "v$version")" ]]; then
            echo "BODY<<EOF" >> $GITHUB_ENV
            echo "$(IFS=$'\n'; echo "${log[*]}")" >> $GITHUB_ENV
            echo "EOF" >> $GITHUB_ENV
            echo "TAG=v$version" >> $GITHUB_ENV
          fi
        shell: bash
      - if: ${{ env.TAG != '' }}
        uses: marocchino/sticky-pull-request-comment@f61b6cf21ef2fcc468f4345cdfcc9bda741d2343 # v2.6.2
        with:
          header: pre-release
          recreate: true
          message: |
            ## ${{ env.TAG }}

            ${{ env.BODY }}
